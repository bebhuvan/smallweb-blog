---
interface Props {
  currentPath?: string;
  currentCategory?: string;
}

const { currentPath = '/', currentCategory } = Astro.props;

const categories = [
  { slug: 'tech', name: 'Tech', color: '--tech' },
  { slug: 'design', name: 'Design', color: '--design' },
  { slug: 'life', name: 'Life', color: '--life' },
  { slug: 'culture', name: 'Culture', color: '--culture' },
  { slug: 'economics', name: 'Economics', color: '--economics' },
  { slug: 'finance', name: 'Finance', color: '--finance' },
  { slug: 'history', name: 'History', color: '--history' },
  { slug: 'psychology', name: 'Psychology', color: '--psychology' },
  { slug: 'philosophy', name: 'Philosophy', color: '--philosophy' },
  { slug: 'science', name: 'Science', color: '--science' },
];

const pageLinks = [
  { href: '/discover', name: 'Discover' },
  { href: '/archive', name: 'Archive' },
  { href: '/blogs', name: 'Blogroll' },
  { href: '/about', name: 'About' },
];

const isHome = currentPath === '/';

function getIssueString() {
  const now = new Date();
  const dayOfYear = Math.floor((now.getTime() - new Date(now.getFullYear(), 0, 0).getTime()) / (1000 * 60 * 60 * 24));
  const monthName = now.toLocaleDateString('en-US', { month: 'long' });
  return `Issue No. ${dayOfYear} Â· ${monthName} ${now.getFullYear()}`;
}
---

<div class="utility-bar">
  <span class="utility-issue">{getIssueString()}</span>
  <nav class="utility-nav">
    {pageLinks.map((link) => (
      <a href={link.href} class:list={["utility-link", currentPath === link.href ? "active" : ""]}>{link.name}</a>
    ))}
    <a href="/rss.xml" class="utility-link rss">RSS</a>
  </nav>
</div>

<header class="masthead">
  <h1 class="masthead-title"><a href="/">The <span class="word-accent">Small</span> Web</a></h1>
  <p class="masthead-sub">small blogs, singular voices</p>
  <hr class="masthead-rule">
</header>

<nav class="nav">
  <a href="/" class:list={["stamp", isHome && !currentCategory ? "active" : ""]}>All</a>
  {categories.map((cat) => {
    const isActive = currentCategory === cat.slug || currentPath === `/category/${cat.slug}`;
    return (
      <a href={`/category/${cat.slug}`} class:list={["stamp", isActive ? "active" : ""]}>
        <span class="stamp-dot" style={`background:var(${cat.color})`}></span>{cat.name}
      </a>
    );
  })}
</nav>

<style>
  .masthead-title a {
    color: inherit;
    text-decoration: none;
  }
</style>
